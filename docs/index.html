<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Advanced NSE Option Signals</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
<style>
:root{
    --bg:#0b1020; --card:#0f1724; --muted:#9aa4c0;
    --accent:#4f46e5; --good:#16a34a; --bad:#ef4444;
}
body{font-family:Roboto,Arial,Helvetica,sans-serif;background:linear-gradient(180deg,#071028 0%, #081026 100%);color:#e6eef8;margin:0;padding:20px}
.container{max-width:1200px;margin:0 auto}
header{display:flex;align-items:center;justify-content:space-between;gap:12px}
h1{margin:4px 0;font-size:22px}
.updated{color:var(--muted);font-size:13px}
.top-cards{display:flex;gap:12px;margin:14px 0;flex-wrap:wrap}
.card{background:var(--card);padding:14px;border-radius:12px;box-shadow:0 8px 30px rgba(3,7,18,0.6);flex:1;min-width:260px}
.card h3{margin:0 0 8px 0;font-size:15px;color:#cfe3ff}
.pill{display:inline-block;padding:6px 10px;border-radius:999px;font-weight:700;font-size:12px}
.buy-pill{background:linear-gradient(90deg, rgba(16,185,129,0.12), rgba(16,185,129,0.04));color:var(--good);border:1px solid rgba(16,185,129,0.12)}
.sell-pill{background:linear-gradient(90deg, rgba(239,68,68,0.08), rgba(239,68,68,0.03));color:var(--bad);border:1px solid rgba(239,68,68,0.06)}
table{width:100%;border-collapse:collapse;margin-top:12px}
th,td{padding:10px 8px;border-bottom:1px solid rgba(255,255,255,0.04);text-align:left;font-size:13px;color:#dbe9ff}
th{background:transparent;color:var(--muted);font-weight:700}
.signal-strong-buy{border-left:6px solid rgba(16,185,129,0.18);background:linear-gradient(90deg, rgba(16,185,129,0.02), transparent)}
.signal-strong-sell{border-left:6px solid rgba(239,68,68,0.18);background:linear-gradient(90deg, rgba(239,68,68,0.02), transparent)}
.muted{color:var(--muted);font-size:13px}
.footer{margin-top:28px;color:var(--muted);font-size:13px;text-align:center}
@media(max-width:880px){.top-cards{flex-direction:column}}
</style>
</head>
<body>
<div class="container">
    <header>
        <div>
            <h1>ðŸŽ¯ Advanced NSE Option Signals</h1>
            <div class="updated" id="updated">Last Updated: â€”</div>
        </div>
        <div class="muted">ATM Â±5 | OI â€¢ COI â€¢ IV â€¢ PCR</div>
    </header>

    <div class="top-cards" id="topCards">
        <!-- Top 3 buys / sells inserted here -->
    </div>

    <div class="card">
        <h3>Signals</h3>
        <table id="signalsTable">
            <thead>
                <tr>
                    <th>Symbol</th><th>Signal</th><th>Opt</th><th>Strike</th><th>ATM</th>
                    <th>LTP</th><th>OI</th><th>COI</th><th>IV</th><th>Score</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <div class="card" style="margin-top:12px">
        <h3>Market Overview</h3>
        <table id="marketTable">
            <thead>
                <tr><th>Symbol</th><th>Price</th><th>ATM</th><th>Strikes</th><th>Updated</th></tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <div class="footer">Built from option-chain data â€¢ Auto-updates via GitHub Actions</div>
</div>

<script>
const fetchPath = "dashboard.json?v=" + Date.now();

fetch(fetchPath)
.then(res => {
    if (!res.ok) throw new Error("Failed to load JSON");
    return res.json();
})
.then(data => {
    document.getElementById("updated").innerText = "Last Updated: " + (data.last_updated || "â€”");

    const top = document.getElementById("topCards");
    top.innerHTML = "";

    const makeCard = (title, list, isBuy) => {
        const wrap = document.createElement("div");
        wrap.className = "card";
        const h = document.createElement("h3"); h.innerText = title; wrap.appendChild(h);
        if (!list || list.length === 0) {
            const p = document.createElement("div"); p.className = "muted"; p.innerText = "No candidates"; wrap.appendChild(p);
            return wrap;
        }
        list.forEach((s, i) => {
            const row = document.createElement("div");
            row.style.marginTop = (i===0? "6px" : "10px");
            row.innerHTML = `
                <div style="display:flex;justify-content:space-between;align-items:center">
                    <div>
                        <strong style="font-size:15px">${s.symbol}</strong> <span class="muted">(${s.option_type})</span>
                        <div class="muted" style="font-size:13px;margin-top:4px">${s.signal} Â· Strike ${s.strike} Â· Score ${s.score}</div>
                    </div>
                    <div style="text-align:right">
                        <div class="pill ${isBuy? 'buy-pill' : 'sell-pill'}" style="margin-bottom:6px">${isBuy? 'BUY' : 'SELL'}</div>
                        <div class="muted" style="font-size:13px">${s.ltp ?? '-'}</div>
                    </div>
                </div>
            `;
            wrap.appendChild(row);
        });
        return wrap;
    };

    top.appendChild(makeCard("Top 3 Buys", data.top_buy || [], true));
    top.appendChild(makeCard("Top 3 Sells", data.top_sell || [], false));

    // signals table
    const tbody = document.querySelector("#signalsTable tbody");
    tbody.innerHTML = "";
    (data.signals || []).forEach(s => {
        const tr = document.createElement("tr");
        const cls = (s.signal || "").includes("BUY") ? "signal-strong-buy" : (s.signal || "").includes("SELL") ? "signal-strong-sell" : "";
        if (cls) tr.className = cls;
        tr.innerHTML = `
            <td><strong>${s.symbol}</strong></td>
            <td>${s.signal || "-"}</td>
            <td>${s.option_type || "-"}</td>
            <td>${s.strike ?? "-"}</td>
            <td>${s.atm ?? "-"}</td>
            <td>${s.ltp ?? "-"}</td>
            <td>${s.oi ?? "-"}</td>
            <td>${s.coi ?? "-"}</td>
            <td>${s.iv ?? "-"}</td>
            <td>${s.score ?? "-"}</td>
        `;
        tbody.appendChild(tr);
    });

    // market table
    const mbody = document.querySelector("#marketTable tbody");
    mbody.innerHTML = "";
    (data.market || []).forEach(m => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td>${m.symbol}</td>
            <td>${m.price}</td>
            <td>${m.atm}</td>
            <td>${m.strikes}</td>
            <td>${m.updated}</td>
        `;
        mbody.appendChild(tr);
    });
})
.catch(err => {
    document.getElementById("updated").innerText = "Failed to load data";
    console.error(err);
});
</script>
</body>
</html>

